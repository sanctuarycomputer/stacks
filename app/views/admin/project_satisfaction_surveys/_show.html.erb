<div class="dashboard-modules table index_table index">
  <div class="dashboard-module">
    <div class="module-body factoid-parent">
      <p style="margin-bottom: 6px;">ğŸ¤« <strong>Note!</strong> In order to gather the most honest feedback, Stacks records all project satisfaction survey responses anonymously, recording only a timestamp when a user submitted their response.</p>
      <a href="https://github.com/sanctuarycomputer/stacks" target="_blank">
        You can audit the Stacks codebase for anonymity here â†—
      </a>
      <p style="margin-top: 12px;">ğŸ“ <strong>Project:</strong> <%= link_to resource.project_capsule.project_tracker.name, admin_project_tracker_path(resource.project_capsule.project_tracker) %></p>
    </div>
  </div>
</div>

<% if resource.status == :draft %>
  <div class="dashboard-modules table index_table index">
    <div class="dashboard-module">
      <div class="module-body factoid-parent">
        <p>ğŸš§ <strong>WIP!</strong> This survey is still being drafted. <%= resource.opens_at.present? ? "It will be open in #{time_ago_in_words(resource.opens_at)}, and you can submit your response then." : "No publish date has been set just yet, but check back soon!" %></p>
      </div>
    </div>
  </div>
<% end %>

<% unless resource.expected_responders.include?(current_admin_user) %>
  <div class="dashboard-modules table index_table index">
    <div class="dashboard-module">
      <div class="module-body factoid-parent">
        <p>ğŸƒ <strong>Note!</strong> You aren't required to respond to this survey.</p>
      </div>
    </div>
  </div>
<% end %>

<% if resource.expected_responders.include?(current_admin_user) && resource.status == :open && project_satisfaction_survey_responder.nil? %>
  <div class="dashboard-modules table index_table index">
    <div class="dashboard-module">
      <div class="module-body factoid-parent">
        <p>âŒ› <strong>OK!</strong> This survey is open!</p>
        <%= link_to "Submit your anonymous Response â†’", new_admin_project_satisfaction_survey_response_path(project_satisfaction_survey_id: resource.id) %>
      </div>
    </div>
  </div>
<% end %>

<% if (resource.expected_responders.include?(current_admin_user) && project_satisfaction_survey_responder.present?) || resource.status == :closed %>
  <div class="dashboard-modules table index_table index">
    <div class="dashboard-module">
      <div class="module-body factoid-parent">
        <% if project_satisfaction_survey_responder.present? %>
          <p>âœ“ <strong>Thank you!</strong> We've registered your anonymous response to this survey.</p>
        <% end %>

        <% if results.present? && current_admin_user.is_admin? %>
          <h5>Summary</h5>
          <p><%= results[:response_count] %> / <%= results[:expected_response_count] %> responses have been recorded (<%= ((results[:response_count].to_f / results[:expected_response_count]) * 100).round %>% response rate).</p>

          <h5>Question Results</h5>
          <% if results[:question_results].any? %>
            <div class="">
              <table class="index_table">
                <thead>
                  <tr>
                    <th>Question</th>
                    <th>Average Sentiment (0-5)</th>
                    <th>Responses</th>
                  </tr>
                </thead>
                <tbody>
                  <% results[:question_results].each do |question, result| %>
                    <tr>
                      <td><%= question.prompt %></td>
                      <td><%= result[:average_sentiment].round(2) %></td>
                      <td><%= result[:response_count] %></td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          <% else %>
            <p>No question responses recorded yet.</p>
          <% end %>

          <h5>Free Text Responses</h5>
          <% if results[:free_text_results].any? %>
            <% results[:free_text_results].each do |question, responses| %>
              <h6><%= question.prompt %></h6>
              <ul>
                <% responses.each do |response| %>
                  <li><%= response %></li>
                <% end %>
              </ul>
            <% end %>
          <% else %>
            <p>No free text responses recorded yet.</p>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
<% end %>

<% if resource.status == :open && current_admin_user.is_admin? %>
  <div class="dashboard-modules table index_table index">
    <div class="dashboard-module">
      <div class="module-header">
        <h3>Current Responder Status</h3>
      </div>
      <div class="module-body">
        <% expected_responder_status.each do |admin_user, responder| %>
          <div>
            <span><%= admin_user.full_name %></span>
            <span style="float: right;"><%= responder.present? ? "âœ“" : "âŒ› Pending Response" %></span>
          </div>
        <% end %>
      </div>
    </div>
  </div>
<% end %>
